<script setup>
import {
  onMounted,
  onUpdated,
  ref
} from "vue";
import { useRoute } from "vue-router";
import { NotionRenderer, getPageBlocks, getPageTable } from "vue3-notion";
import mermaid from "mermaid";
import "prismjs";
import "prismjs/components/prism-python";
import "prismjs/components/prism-c";
import "prismjs/components/prism-cpp";

import { CodeBlock } from "vue3-code-block";

const route = useRoute();

const post = ref(null);
const table = ref(null);
const title = ref(null);
const pdf = ref(null);
const code = ref([]);

onMounted(async () => {
  const id = route.params.id;
  if (id) {
    post.value = await getPageBlocks(id);
    table.value = await getPageTable(id);
    for (let row of table.value) {
      if (row.id === id) {
        title.value = row.title;
        if (row.pdf)
          pdf.value = row.pdf;
        break;
      }
    }
    console.log(post.value);

  }
  mermaid.initialize({ startOnLoad: true });
});

const renderMermaid = () => {
  mermaid.init(undefined, document.getElementsByClassName("language-mermaid"));
};

</script>
<template>
  <v-container>
    <v-row no-gutters>
      <v-col cols="12" md="8" offset-md="2">
        <v-card class="elevation-3 pa-4">
          <v-card-title class="mt-2 text-wrap text-h4">
            {{ title }}
            <v-btn-group>
              <v-btn
                v-for="file in pdf"
                :key="file.name"
                :href="file.name"
                target="_blank"
                icon
                class="ma-1"
              >
                <v-icon>mdi-file-outline</v-icon>
              </v-btn>
            </v-btn-group>
          </v-card-title>
            <NotionRenderer
                      v-if="post"
                      :blockMap="post"
                      katex
                      :class="$vuetify.theme.global.current.dark ? 'dark-mode ma-3' : 'ma-3'"
                      @click="renderMermaid"
                    />
        </v-card>
      </v-col>
    </v-row>
  </v-container>
</template>
<style>
@import "katex/dist/katex.min.css";
@import "vue3-notion/dist/style.css";
@import "prismjs/themes/prism.css";
</style>